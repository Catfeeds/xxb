<%- model_class = Lesson -%>
<% unless current_user.has_role? :admin %> 

<% if session[:textbook_id] %>
  <%= link_to "返回目录", catalogs_path, class: 'btn btn-default pull-right' %>
<% end %>
<% if @next_lesson %>
<%= link_to "下一篇", lesson_path(@next_lesson), class: 'btn btn-default pull-right' %>
<% end %>
<% if @previous_lesson %>
<%= link_to "上一篇", lesson_path(@previous_lesson), class: 'btn btn-default pull-right' %>
<% end %>
<% if @discussion_lesson %>
<%= link_to "返回讨论的课文", lesson_path(@discussion_lesson), class: 'btn btn-default pull-right' %>
<% end %>

<div class="page-header">
  <h1><%= @lesson.title %></h1>
  <p class="text-right">字数：<%= @lesson.content_length %></p>
</div>
  <% if @lesson.picture_file_name %>
    <%= image_tag @lesson.picture.url, class: "img-responsive center-block"  %>
<hr>
  <% end %>
  <div class="lesson_paragraph"><%= sanitize(@lesson.content) %></div>
<hr>
<% if current_user.id == @lesson.user_id  %>
<%= link_to "新建", new_lesson_path, :class => 'btn btn-primary', tabindex: 50 %>
<%= link_to t('.back', :default => t("helpers.links.back")),
              lessons_path, :class => 'btn btn-default', tabindex: 51  %>
<%= link_to t('.edit', :default => t("helpers.links.edit")),
              edit_lesson_path(@lesson), :class => 'btn btn-default', tabindex: 52 %>
<%= link_to t('.destroy', :default => t("helpers.links.destroy")),
              lesson_path(@lesson),
              :method => 'delete',
              :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
              :class => 'btn btn-default', tabindex: 53 %>
<% end %>

<% if @tutor %>
  <%= link_to "标准辅导", tutor_path(@tutor), class: 'btn btn-success pull-right' %>
<% end %>

<% unless session[:discussion_id] %>
  <% if @lesson.teachings.empty? %>
    <%= link_to "添加教学方案", new_teaching_path, class: 'btn btn-default pull-right' %>
  <% else %>
    <%= link_to "教学方案列表", teachings_path, class: 'btn btn-default pull-right' %>
  <% end %>
  <% if @lesson.tutors.empty? %>
    <%= link_to "添加辅导", new_tutor_path, class: 'btn btn-default pull-right' %>
  <% else %>
    <%= link_to "辅导", tutor_path(@lesson.tutors.order(:difficulty).first), class: 'btn btn-default pull-right' %>
  <% end %>
  <% if @lesson.practices.empty? %>
    <%= link_to "添加练习", new_practice_path, class: 'btn btn-default pull-right' %>
  <% else %>
    <%= link_to "练习", practices_path, class: 'btn btn-default pull-right' %>
    <%= link_to "随机练习", new_evaluation_path, class: 'btn btn-default pull-right' %>
  <% end %>
<% end %>

<% else %>

<div class="page-header">
  <h1><%=t '.title', :default => model_class.model_name.human.titleize %></h1>
</div>

<dl class="dl-horizontal">
  <dt><strong><%= model_class.human_attribute_name(:title) %>:</strong></dt>
  <dd><%= @lesson.title %></dd>
  <dt><strong><%= model_class.human_attribute_name(:content) %>:</strong></dt>
  <dd><%= @lesson.content %></dd>
  <dt><strong><%= model_class.human_attribute_name(:content_length) %>:</strong></dt>
  <dd><%= @lesson.content_length %></dd>
  <dt><strong><%= model_class.human_attribute_name(:user_id) %>:</strong></dt>
  <dd><%= @lesson.user_id %></dd>
</dl>

<%= link_to t('.back', :default => t("helpers.links.back")),
              lessons_path, :class => 'btn btn-default'  %>
<%= link_to t('.edit', :default => t("helpers.links.edit")),
              edit_lesson_path(@lesson), :class => 'btn btn-default' %>
<%= link_to t('.destroy', :default => t("helpers.links.destroy")),
              lesson_path(@lesson),
              :method => 'delete',
              :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
              :class => 'btn btn-danger' %>
<% end %>
